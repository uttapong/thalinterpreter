exports.numtidy=function(value){
	value=value.trim();
	if(isNaN(value)||value==null||value=='')return 0;
	else return parseFloat(value);
}
exports.interprete = function(req,type) {

	if(type==='live')data=req.body;
	else if(type==='single') data=req.typing;
	else if(type==='batch')data=req.typing;

	data.hbe=data.hbe || 0;
	data.a2=data.a2 || 0;
	data.hbcs=data.hbe || 0;
	data.a=data.a || 0;
	data.f=data.f || 0;
	data.hbe=data.hbe || 0;
	data.bart_h=data.bart_h || 0;
	data.mcv=data.mcv || 0;
	data.mch=data.mch || 0;

	var isMCH=data.mch&&data.mch!==''&&data.mch!=='-'&&data.mch!==0;
	console.log("isMCh : "+isMCH)
//check for CE Machine
	//if(data.a2!=0 && data.hbe!=0){
//	var livedata={dcip:parseFloat(req.dcip)||0, hb:parseFloat(req.hb)||0, a:parseFloat(req.a)||0, a2:req.a2||0, f:parseFloat(req.f)||0, hbe:parseFloat(req.hbe)||0, hbcs:parseFloat(req.hbcs)||0, bart_h:parseFloat(req.bart_h)||0, mcv:parseFloat(req.mcv||0)};
//	var liveresult={};
	var result='NA';

		var a2e=parseFloat(data.a2)+parseFloat(data.hbe);
		data.a2=a2e;
		data.hbe=a2e;

		console.log(data);
	//}
	console.log('start rule----------------------');
	if(data.f>60){
		console.log('possilbe Fetal');
		if(data.hbe==0&&data.hbcs==0)result= 'HOMO_BETA_THAL';
		if(data.hbe==0&&data.hbcs==0&&data.bart_h>=10)result= 'FETUS_WITH_ALPHA_THAL';
		if(data.hbe==0&&data.hbcs==0&&data.bart_h<10)result= 'NORMAL_FETAL';

		if(data.hbe>0&&data.hbcs==0)result= 'FETUS_WITH_BETA_THAL_E';
		if(data.hbe>0&&data.hbcs==0&&data.bart_h>=10)result= 'FETUS_WITH_HBE_ALPHA_THAL';
		if(data.hbe>0&&data.hbcs==0&&data.bart_h<10)result= 'FETUS_WITH_HB_E';

		if(data.hbe>0&&data.hbcs>0&&data.bart_h>=10) result= 'FETUS_WITH_HBE_CS';

	}
	else{

		if(data.a2<=3.5){
			console.log('-----------------------------------Possible Alpha thal');
			if(data.bart_h>0){
				if(data.hbcs>0){
					if(data.mcv>=80)result= 'HB_HOMO_CS';
					else result= 'HB_H_CS';
				}
				else if(data.hbcs<=0){

					if(isMCH) if(data.mcv<80 && data.mch<25)result= 'HB_H';
					if(!isMCH) if(data.mcv<80)result= 'HB_H';
				}

			}
			else if(data.bart_h<=0){
				//console.log('in here 3----------------------');
				if(data.hbcs>0){
					if(isMCH){ if(data.mcv>75 && data.mch>20)result= 'HB_HOMO_CS';else result= 'HB_CS';}

					if(!isMCH){ if(data.mcv>75)result= 'HB_HOMO_CS';	else result= 'HB_CS';}

				}
				else if(data.hbcs<=0){
					if(isMCH)
					{
						if(data.mcv>=85 && data.mch>=25)result= 'NORMAL_HB';
						else if(data.mcv<75 && data.mch<25)result= 'ALPHA_THAL_TRAIT';
					}
					if(!isMCH){
						if(data.mcv>=85 )result= 'NORMAL_HB';
						else if(data.mcv<75)result= 'ALPHA_THAL_TRAIT';
					}

					/**** suspicious****/

					if(data.mcv>=75&&data.mcv<85)result= 'ALPHA_THAL_2';

						//if(data.mcv>=75)result= 'ALPHA_THAL_2';

				}
			}

		}

		if(data.a2>3.5){
			console.log('-----------------------------------Possible Beta thal');
			if(isMCH){ if(data.a2<8&&data.mcv<75 && data.mch<25)result= 'BETA_THAL';}
			if(!isMCH){ if(data.a2<8&&data.mcv<75)result= 'BETA_THAL'; }

			if(data.a2>=8){
				if(data.bart_h>0){
					if(data.hbcs>0){
						if(data.hbe>75)result= 'EF_BART_CS';
						else result= 'AE_BART_CS';
					}
					else if(data.hbcs<=0){
						if(data.hbe>75)result= 'EF_BART';
						else result= 'AE_BART';
					}
				}
				else if(data.bart_h<=0){
					if(data.hbe>35){
						if(data.hbe>75)result= 'HBE_HOMO';
						else result= 'BETA_THAL_HBE';
					}
					else if(data.hbe<=35){
						if(isMCH){
							if(data.hbe<25||(data.mcv<=70 && data.mch <25))result= 'HBE_WITH_ALPHA_THAL1';
							if((data.hbe>20&&data.hbe<=35)||(data.mcv>70 && data.mch>=25))result= 'HBE_TRAIT';
						}
						if(!isMCH){
							if(data.hbe<25||(data.mcv<=70))result= 'HBE_WITH_ALPHA_THAL1';
							if((data.hbe>20&&data.hbe<=35)||data.mcv>70)result= 'HBE_TRAIT';
						}
					}
				}
			}
		}
	}//else after check for f
	return result;
};


exports.liveinterprete = function(reqdata) {
var req=reqdata.body;
console.log(req.a2);
var data={dcip:parseFloat(req.dcip)||0, hb:parseFloat(req.hb)||0, a:parseFloat(req.a)||0, a2:req.a2||0, f:parseFloat(req.f)||0, hbe:parseFloat(req.hbe)||0, hbcs:parseFloat(req.hbcs)||0, bart_h:parseFloat(req.bart_h)||0, mcv:parseFloat(req.mcv||0)};
var result={};
		var a2e=parseFloat(data.a2)+parseFloat(data.hbe);
		data.a2=a2e;
		data.hbe=a2e;
	//}
	//console.log('in here 1----------------------');

	if(data.f>60&&data.hbe==0&&data.hbcs==0)result.HOMO_BETA_THAL=1 ;else result.HOMO_BETA_THAL=0;
	if(data.f>60&&data.hbe==0&&data.hbcs==0&&data.bart_h>=10)result.FETUS_WITH_ALPHA_THAL=1; else result.FETUS_WITH_ALPHA_THAL=0;
	if(data.f>60&&data.hbe==0&&data.hbcs==0&&data.bart_h<10)result.NORMAL_FETAL=1;else result.NORMAL_FETAL=0;

	if(data.f>60&&data.hbe>0&&data.hbcs==0)result.FETUS_WITH_BETA_THAL_E=1;else result.FETUS_WITH_BETA_THAL_E=0;
	if(data.f>60&&data.hbe>0&&data.hbcs==0&&data.bart_h>=10)result.FETUS_WITH_HBE_ALPHA_THAL=1;else result.FETUS_WITH_HBE_ALPHA_THAL=0;
	if(data.f>60&&data.hbe>0&&data.hbcs==0&&data.bart_h<10)result.FETUS_WITH_HB_E=1;else result.FETUS_WITH_HB_E=0;

	if(data.f>60&&data.hbe>0&&data.hbcs>0&&data.bart_h>=10) result.FETUS_WITH_HBE_CS=1;else result.FETUS_WITH_HBE_CS=0;


	//a2 <=3.5
	if(data.a2<=3.5&&data.hbcs>0&&(data.bart_h>0&&data.mcv>80)||(data.bart_h<=0&&data.mcv>75))result.HB_HOMO_CS=1;else  result.HB_HOMO_CS=0;
	if(data.a2<=3.5&&data.bart_h>0&&data.hbcs>0&&data.mcv<=80)result.HB_H_CS=1;else  result.HB_H_CS=0;
	if(data.a2<=3.5&&data.bart_h>0&&data.hbcs<=0&&data.mcv<80)result.HB_H=1;else  result.HB_H=0;

	//if(data.a2<=3.5&&result.HB_HOMO_CS=1;else  result.HB_HOMO_CS=0;
	if(data.a2<=3.5&&data.bart_h<=0&&data.hbcs>0&&data.mcv<=75)result.HB_CS=1;else  result.HB_CS=0;

	if(data.a2<=3.5&&data.bart_h<=0&&data.hbcs<=0&&data.mcv>=85)result.NORMAL_HB=1;else  result.NORMAL_HB=0;
	if(data.a2<=3.5&&data.bart_h<=0&&data.hbcs<=0&&data.mcv<75)result.ALPHA_THAL_TRAIT=1;else  result.ALPHA_THAL_TRAIT=0;
	if(data.a2<=3.5&&data.bart_h<=0&&data.hbcs<=0&&data.mcv>=75)result.ALPHA_THAL_2=1;else  result.ALPHA_THAL_2=0;

	//a2 >3.5

	if(data.a2>3.5&&data.a2<8&&data.mcv<75)result.BETA_THAL=1;else  result.BETA_THAL=0;

	if(data.a2>=8&&data.bart_h>0&&data.hbcs>0&&data.hbe>75)result.EF_BART_CS=1;else  result.EF_BART_CS=0;
	if(data.a2>=8&&data.bart_h>0&&data.hbcs>0&&data.hbe<=75) result.AE_BART_CS=1;else  result.AE_BART_CS=0;

	if(data.a2>=8&&data.bart_h>0&&data.hbcs<=0&&data.hbe>75)result.EF_BART=1;else  result.EF_BART=0;
	if(data.a2>=8&&data.bart_h>0&&data.hbcs<=0&&data.hbe<=75) result.AE_BART=1;else  result.AE_BART=0;


	if(data.a2>=8&&data.bart_h<=0&&data.hbe>35&&data.hbe>75)result.HBE_HOMO=1;else  result.HBE_HOMO=0;
	if(data.a2>=8&&data.bart_h<=0&&data.hbe>35&&data.hbe<=75) result.BETA_THAL_HBE=1;else  result.BETA_THAL_HBE=0;

	if(data.a2>=8&&data.bart_h<=0&&data.hbe<=35&&(data.hbe<25||data.mcv<70))result.HBE_WITH_ALPHA_THAL1=1;else  result.HBE_WITH_ALPHA_THAL1=0;
	if(data.a2>=8&&data.bart_h<=0&&data.hbe<=35&&((data.hbe>20&&data.hbe<=35)||data.mcv>70))result.HBE_TRAIT=1;else  result.HBE_TRAIT=0;
	console.log(data);
	return result;


};
